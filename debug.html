<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/chatbot.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #1e293b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 400px;
            z-index: 10000;
            max-height: 80vh;
            overflow-y: auto;
        }
        .debug-button {
            background: #38BDF8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
            font-size: 12px;
        }
        .debug-button:hover {
            background: #0EA5E9;
        }
        .debug-log {
            background: #0f172a;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            border-left: 3px solid #38BDF8;
        }
        .debug-error {
            border-left-color: #ef4444;
            background: #1f2937;
        }
        .debug-success {
            border-left-color: #10b981;
            background: #064e3b;
        }
    </style>
</head>
<body>
    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel" id="debugPanel">
        <h3>ğŸ”§ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ ãƒ‡ãƒãƒƒã‚°</h3>
        <div id="debugLogs"></div>
        <div style="margin-top: 10px;">
            <button class="debug-button" onclick="testApiEndpoint()">APIãƒ†ã‚¹ãƒˆ</button>
            <button class="debug-button" onclick="testChatbotInit()">ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
            <button class="debug-button" onclick="testFormIntegration()">ãƒ•ã‚©ãƒ¼ãƒ é€£æºãƒ†ã‚¹ãƒˆ</button>
            <button class="debug-button" onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <!-- ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
    <div style="margin-top: 200px; padding: 20px;">
        <h1>ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã§ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>
        
        <!-- ãƒ•ã‚©ãƒ¼ãƒ é€£æºãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªãƒ•ã‚©ãƒ¼ãƒ  -->
        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3>ãƒ•ã‚©ãƒ¼ãƒ é€£æºãƒ†ã‚¹ãƒˆ</h3>
            <input type="text" id="name" placeholder="ãŠåå‰" style="margin: 5px; padding: 8px; width: 200px;">
            <input type="text" id="company" placeholder="ä¼šç¤¾å" style="margin: 5px; padding: 8px; width: 200px;">
            <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" style="margin: 5px; padding: 8px; width: 200px;">
            <select id="service" style="margin: 5px; padding: 8px; width: 200px;">
                <option value="">ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ</option>
                <option value="ai">AIå°å…¥ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°</option>
                <option value="system">ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ã‚µãƒãƒ¼ãƒˆ</option>
                <option value="ec">ECãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´</option>
                <option value="development">ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º</option>
            </select>
            <textarea id="message" placeholder="ãŠå•ã„åˆã‚ã›å†…å®¹" style="margin: 5px; padding: 8px; width: 400px; height: 100px;"></textarea>
        </div>
    </div>

    <!-- ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="chatbot-desktop" style="position: fixed; bottom: 20px; right: 20px; width: 400px; height: 600px;"></div>

    <!-- JavaScript -->
    <script src="./js/main.js"></script>
    <script src="./js/chatbot.js"></script>
    
    <script>
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°é–¢æ•°
        function addDebugLog(message, type = 'info') {
            const logs = document.getElementById('debugLogs');
            const logDiv = document.createElement('div');
            logDiv.className = `debug-log ${type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : ''}`;
            logDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(logDiv);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('debugLogs').innerHTML = '';
        }

        // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
        async function testApiEndpoint() {
            addDebugLog('ğŸ” APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'info');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
                        formData: {},
                        context: 'debug_test'
                    })
                });

                addDebugLog(`ğŸ“¡ API Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    addDebugLog(`âœ… API Response: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                } else {
                    const errorText = await response.text();
                    
                    // 501ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®åˆ¶é™ã‚’èª¬æ˜
                    if (response.status === 501) {
                        addDebugLog(`âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼åˆ¶é™: POSTãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“`, 'info');
                        addDebugLog(`ğŸ’¡ è§£æ±ºæ–¹æ³•: local-api-server.py ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„`, 'info');
                        addDebugLog(`ğŸ“ ã‚³ãƒãƒ³ãƒ‰: python3 local-api-server.py`, 'info');
                    } else {
                        addDebugLog(`âŒ API Error: ${errorText}`, 'error');
                    }
                }
            } catch (error) {
                if (error.message.includes('Failed to fetch')) {
                    addDebugLog(`ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“`, 'error');
                    addDebugLog(`ğŸ’¡ ç¢ºèªäº‹é …: ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„`, 'info');
                } else {
                    addDebugLog(`ğŸ’¥ Fetch Error: ${error.message}`, 'error');
                }
            }
        }

        // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–ã®ãƒ†ã‚¹ãƒˆ
        function testChatbotInit() {
            addDebugLog('ğŸ¤– ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåˆæœŸåŒ–ã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'info');
            
            // ChatbotAssistantã‚¯ãƒ©ã‚¹ã®å­˜åœ¨ç¢ºèª
            if (typeof ChatbotAssistant !== 'undefined') {
                addDebugLog('âœ… ChatbotAssistant ã‚¯ãƒ©ã‚¹ãŒå­˜åœ¨ã—ã¾ã™', 'success');
            } else {
                addDebugLog('âŒ ChatbotAssistant ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }

            // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç¢ºèª
            if (window.chatbot) {
                addDebugLog('âœ… ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™', 'success');
                addDebugLog(`ğŸ“Š ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${window.chatbot.messages.length}`, 'info');
            } else {
                addDebugLog('âŒ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }

            // DOMè¦ç´ ã®ç¢ºèª
            const container = document.getElementById('chatbot-container');
            if (container) {
                addDebugLog('âœ… ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠãŒå­˜åœ¨ã—ã¾ã™', 'success');
            } else {
                addDebugLog('âŒ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€£æºã®ãƒ†ã‚¹ãƒˆ
        function testFormIntegration() {
            addDebugLog('ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ é€£æºã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'info');
            
            if (window.chatbot) {
                const formData = window.chatbot.getFormData();
                addDebugLog(`ğŸ“Š ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(formData)}`, 'info');
                
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨ç¢ºèª
                const fields = ['name', 'company', 'email', 'service', 'message'];
                fields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        addDebugLog(`âœ… ${field} ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã—ã¾ã™`, 'success');
                    } else {
                        addDebugLog(`âŒ ${field} ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'error');
                    }
                });
            } else {
                addDebugLog('âŒ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
        window.addEventListener('load', () => {
            addDebugLog('ğŸš€ ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
            
            // å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            setTimeout(() => {
                testChatbotInit();
                testFormIntegration();
            }, 1000);
        });

        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            addDebugLog(`ğŸ“ LOG: ${args.join(' ')}`, 'info');
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            addDebugLog(`âŒ ERROR: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            addDebugLog(`âš ï¸ WARN: ${args.join(' ')}`, 'info');
            originalWarn.apply(console, args);
        };
    </script>
</body>
</html>
