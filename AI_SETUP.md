# AIチャットボット設定ガイド

## 概要

このプロジェクトには、OpenAI APIと連携したAIチャットボット機能が実装されています。

## 機能

- 🤖 **AI応答生成**: OpenAI GPT-4o-miniを使用した自然な会話
- 📝 **フォーム連携**: 問い合わせフォームの入力状況を分析
- ✍️ **メッセージ下書き**: 自動でメッセージを作成
- 🔄 **フォールバック機能**: API未接続時も動作
- 💾 **履歴保存**: 会話履歴をlocalStorageで保持

## セットアップ

### 1. OpenAI APIキーの設定

#### 方法A: 環境変数（推奨）
```bash
export OPENAI_API_KEY="your-openai-api-key-here"
```

#### 方法B: 設定ファイルの直接編集
`config.js`ファイルの`AI_CONFIG.apiKey`を編集：
```javascript
apiKey: 'your-openai-api-key-here',
```

### 2. APIキーの取得方法

1. [OpenAI Platform](https://platform.openai.com/)にアクセス
2. アカウントを作成またはログイン
3. API Keysセクションで新しいキーを作成
4. 作成されたキーをコピーして設定

### 3. 料金について

- **GPT-4o-mini**: 非常に低コスト（$0.00015/1K tokens入力、$0.0006/1K tokens出力）
- **使用量**: チャットボットの応答は短めに設定されているため、コストは最小限
- **無料枠**: 新規アカウントには$5の無料クレジットが付与

## アーキテクチャ

### フロントエンド
- `js/chatbot.js`: チャットボットのUIとロジック
- `css/chatbot.css`: チャットボットのスタイル
- `config.js`: 設定ファイル

### AI処理
- `api/chat.js`: AI応答生成とフォールバック処理
- OpenAI API連携
- フォームデータの分析

### フォールバック機能
APIが利用できない場合の自動フォールバック：
- 事前定義された応答パターン
- フォームデータに基づく動的応答
- エラーハンドリング

## 使用方法

### 基本操作
1. 問い合わせフォームを開く
2. チャットボットが自動で起動
3. メッセージを入力またはクイックアクションを使用

### クイックアクション
- 🤖 サービス選択のヘルプ
- ✍️ メッセージ下書き
- 💰 料金について
- 📞 連絡先情報
- ❓ 使い方ガイド

### フォーム連携
- フォーム入力の変更を自動検知
- 入力状況に応じた提案
- リアルタイムサポート

## カスタマイズ

### 企業情報の変更
`config.js`の`COMPANY_CONFIG`を編集：

```javascript
const COMPANY_CONFIG = {
    name: "あなたの会社名",
    services: {
        // サービス情報を更新
    },
    contact: {
        // 連絡先情報を更新
    }
};
```

### AI応答の調整
`api/chat.js`の`buildSystemPrompt`関数を編集：

```javascript
function buildSystemPrompt(formData) {
    return `あなたのカスタムプロンプト...`;
}
```

### チャットボットの外観
`css/chatbot.css`を編集してデザインを変更。

## デプロイ

### GitHub Pages
1. リポジトリをGitHubにプッシュ
2. Settings → Pages → Deploy from branch
3. ブランチを`main`に設定

### 本番環境での注意点
- APIキーは環境変数で管理
- HTTPSを使用（OpenAI APIの要件）
- レート制限の設定

## トラブルシューティング

### よくある問題

#### 1. AI応答が表示されない
- APIキーが正しく設定されているか確認
- ネットワーク接続を確認
- ブラウザのコンソールでエラーを確認

#### 2. フォールバック応答のみ表示される
- OpenAI APIキーが有効か確認
- 使用量制限に達していないか確認
- APIエンドポイントが正しいか確認

#### 3. チャットボットが表示されない
- JavaScriptが有効になっているか確認
- ファイルパスが正しいか確認
- ブラウザのキャッシュをクリア

### デバッグモード
`config.js`でデバッグを有効化：

```javascript
const AI_CONFIG = {
    debug: true,
    logRequests: true
};
```

## セキュリティ

### APIキーの保護
- フロントエンドに直接APIキーを埋め込まない
- 環境変数またはサーバーサイドで管理
- 定期的にAPIキーをローテーション

### レート制限
- ユーザーあたりのリクエスト数を制限
- スパム対策の実装
- 適切なタイムアウト設定

## 今後の拡張

### 計画中の機能
- [ ] 音声入力対応
- [ ] 多言語対応
- [ ] RAG（Retrieval-Augmented Generation）
- [ ] FAQデータベース連携
- [ ] 会話履歴の分析

### 技術的改善
- [ ] Streaming応答
- [ ] キャッシュ機能
- [ ] より高度なフォールバック
- [ ] パフォーマンス最適化

## サポート

問題が発生した場合：
1. このドキュメントを確認
2. ブラウザのコンソールでエラーを確認
3. GitHub Issuesで報告

---

**注意**: このプロジェクトは教育・デモ目的で作成されています。本番環境での使用前に、セキュリティとパフォーマンスの検証を行ってください。
